<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Kalyan AI Predictor Pro - V10</title>
    <style>
        :root { --gold: #ffd700; --red: #ff3131; --bg: #0d1117; --card: #161b22; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 15px; }
        .header { text-align: center; border-bottom: 2px solid var(--gold); margin-bottom: 20px; }
        .controls { display: flex; gap: 10px; justify-content: center; background: var(--card); padding: 15px; border-radius: 10px; border: 1px solid #30363d; }
        
        /* Table Style */
        .table-wrap { position: relative; background: #fff; display: inline-block; border: 4px solid #444; border-radius: 5px; }
        table { border-collapse: collapse; color: #000; font-size: 15px; }
        td, th { border: 1px solid #ccc; width: 45px; height: 45px; text-align: center; font-weight: bold; cursor: pointer; }
        th { background: #600; color: #fff; font-size: 10px; }
        
        .blank-cell { background: #fff9db !important; border: 2px dashed #f00 !important; }
        .circle-mark { background: var(--red) !important; color: #fff !important; border-radius: 50%; width: 35px; height: 35px; line-height: 35px; display: inline-block; box-shadow: 0 0 10px var(--red); position: relative; z-index: 10; }
        
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid #30363d; text-align: center; }
        .prediction { font-size: 55px; color: var(--gold); font-weight: bold; text-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }
        
        canvas { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 5; }
        button { background: var(--gold); color: #000; border: none; padding: 10px 18px; font-weight: bold; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="header">
    <h1>üéØ AI PATTERN SENSOR V10</h1>
    <p>‡§Ü‡§™‡§ï‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•á ‡§°‡•â‡§ü (.) ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§ï‡•ã ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡§§‡§æ ‡§π‡•à</p>
</div>

<div class="controls">
    <input type="file" id="csvUploader" accept=".csv,.txt">
    <button onclick="addRow()">‚ûï ‡§∞‡•ã ‡§ú‡•ã‡•ú‡•á‡§Ç</button>
    <button onclick="saveData()">üíæ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
</div>

<center>
    <div class="table-wrap">
        <canvas id="canvas"></canvas>
        <table id="mainTable"></table>
    </div>
</center>

<div class="dashboard">
    <div class="card">
        <h3>üîç AI ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</h3>
        <div id="status">‡§´‡§º‡§æ‡§á‡§≤ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ñ‡§æ‡§≤‡•Ä ‡§¨‡•â‡§ï‡•ç‡§∏ (**) ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç</div>
    </div>
    <div class="card">
        <h3>üîÆ AI ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä (80% ‡§∏‡§ü‡•Ä‡§ï)</h3>
        <div id="result" class="prediction">--</div>
        <div id="confidence">‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ: 0%</div>
    </div>
</div>

<script>
let chart = JSON.parse(localStorage.getItem('kalyan_v10')) || [
    ["12","46","78","88","88","45"],
    ["**","**","**","**","**","**"]
];

// ‡§∞‡§æ‡§∂‡§ø (Family) ‡§≤‡•â‡§ú‡§ø‡§ï
const rashi = {'1':'6','6':'1','2':'7','7':'2','3':'8','8':'3','4':'9','9':'4','5':'0','0':'5'};

function getFamily(jodi) {
    if(jodi === "**") return [];
    let a = jodi[0], b = jodi[1];
    let ra = rashi[a], rb = rashi[b];
    return [a+b, b+a, a+rb, ra+b, ra+rb, rb+ra, b+ra, rb+a];
}

document.getElementById('csvUploader').onchange = function(e) {
    let reader = new FileReader();
    reader.onload = function() {
        // ‡§Ü‡§™‡§ï‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•á ‡§°‡•â‡§ü (.) ‡§ï‡•ã ‡§ï‡•ã‡§Æ‡§æ ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§ï‡§∞ ‡§∞‡•Ä‡§° ‡§ï‡§∞‡§®‡§æ
        chart = reader.result.split('\n')
                      .filter(r => r.trim() !== "")
                      .map(r => r.replace(/\./g, ',').split(',').map(v => v.trim().padStart(2, '0').replace('0**', '**')));
        render();
    };
    reader.readAsText(e.target.files[0]);
};

function render() {
    let html = "<tr><th>‡§∏‡•ã‡§Æ</th><th>‡§Æ‡§Ç‡§ó‡§≤</th><th>‡§¨‡•Å‡§ß</th><th>‡§ó‡•Å‡§∞‡•Å</th><th>‡§∂‡•Å‡§ï‡•ç‡§∞</th><th>‡§∂‡§®‡§ø</th></tr>";
    chart.forEach((row, rIdx) => {
        html += "<tr>";
        row.forEach((val, cIdx) => {
            let isBlank = (val === "**");
            let isMarked = activePoints.some(p => p.r === rIdx && p.c === cIdx);
            html += `<td class="${isBlank ? 'blank-cell' : ''}" onclick="${isBlank ? `predict(${rIdx}, ${cIdx})` : ''}">
                        ${isMarked ? `<span class="circle-mark">${val}</span>` : val}
                    </td>`;
        });
        html += "</tr>";
    });
    document.getElementById('mainTable').innerHTML = html;
    if(activePoints.length > 0) drawLines();
}

let activePoints = [];

function predict(r, c) {
    activePoints = [];
    let candidates = {};
    let count = 0;

    for(let i = 0; i < r; i++) {
        let score = 0;
        let pFound = [];
        
        // ‡§™‡§ø‡§õ‡§≤‡•á 3 ‡§π‡§´‡§º‡•ç‡§§‡•ã‡§Ç ‡§ï‡•Ä ‡§ö‡§æ‡§≤ ‡§ö‡•á‡§ï ‡§ï‡§∞‡§®‡§æ
        for(let gap = 1; gap <= 3; gap++) {
            if(r-gap >= 0 && i-gap >= 0) {
                let currentFam = getFamily(chart[r-gap][c]);
                if(currentFam.includes(chart[i-gap][c])) {
                    score += 25;
                    pFound.push({r: i-gap, c: c});
                }
            }
        }

        if(score >= 25) {
            let val = chart[i][c];
            if(val !== "**") {
                candidates[val] = (candidates[val] || 0) + score;
                count++;
                activePoints = [...activePoints, ...pFound];
            }
        }
    }

    let best = Object.keys(candidates).reduce((a, b) => candidates[a] > candidates[b] ? a : b, "--");
    document.getElementById('result').innerText = best;
    document.getElementById('confidence').innerText = `‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ: ${Math.min(85, count*20)}%`;
    document.getElementById('status').innerText = `AI ‡§®‡•á ${count} ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡•à‡§ö ‡§ï‡§ø‡§è‡•§`;
    render();
}

function drawLines() {
    const canvas = document.getElementById('canvas');
    const table = document.getElementById('mainTable');
    const ctx = canvas.getContext('2d');
    canvas.width = table.offsetWidth; canvas.height = table.offsetHeight;
    ctx.clearRect(0,0, canvas.width, canvas.height);
    ctx.strokeStyle = "rgba(255, 215, 0, 0.5)";
    ctx.lineWidth = 2;
    let rect = table.getBoundingClientRect();
    let circles = document.querySelectorAll('.circle-mark');
    circles.forEach(c => {
        let r = c.getBoundingClientRect();
        ctx.beginPath();
        ctx.moveTo(canvas.width/2, canvas.height/2);
        ctx.lineTo(r.left - rect.left + r.width/2, r.top - rect.top + r.height/2);
        ctx.stroke();
    });
}

function addRow() { chart.push(["**","**","**","**","**","**"]); render(); }
function saveData() { localStorage.setItem('kalyan_v10', JSON.stringify(chart)); alert("‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ!"); }

render();
</script>
</body>
</html>
