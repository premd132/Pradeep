<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Kalyan AI Pattern Master V8 - Table Trick & CSV</title>
    <style>
        :root { --gold: #ffd700; --red: #ff3e3e; --bg: #0d0d0d; --card: #1a1a1a; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 10px; }
        
        .header { text-align: center; padding: 10px; border-bottom: 2px solid var(--gold); margin-bottom: 20px; }
        .controls { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; background: var(--card); padding: 15px; border-radius: 10px; }
        
        /* Chart Design */
        .table-container { position: relative; background: #fff; display: inline-block; border: 3px solid #444; box-shadow: 0 0 30px rgba(255,215,0,0.2); }
        table { border-collapse: collapse; color: #000; font-size: 16px; }
        td, th { border: 1px solid #999; width: 45px; height: 45px; text-align: center; font-weight: bold; position: relative; }
        th { background: #800000; color: #fff; font-size: 11px; text-transform: uppercase; }
        
        .blank { background: #fffde6 !important; cursor: pointer; border: 2px dashed #f00 !important; }
        .circle { background: var(--red) !important; color: #fff !important; border-radius: 50%; width: 35px; height: 35px; line-height: 35px; display: inline-block; z-index: 10; position: relative; }
        
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 20px; }
        .card { background: var(--card); padding: 15px; border-radius: 10px; border-left: 5px solid var(--gold); }
        .card h3 { color: var(--gold); margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 5px; }

        canvas { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 5; }
        button { background: var(--gold); color: #000; border: none; padding: 10px 15px; font-weight: bold; border-radius: 5px; cursor: pointer; }
        input[type="file"] { background: #333; color: white; padding: 8px; border-radius: 5px; border: 1px solid #444; }
    </style>
</head>
<body>

<div class="header">
    <h1>üèÜ KALYAN AI PATTERN MASTER <span style="font-size: 14px; color: #fff;">(V8 - TABLE TRICK)</span></h1>
</div>

<div class="controls">
    <input type="file" id="csvFile" accept=".csv">
    <button onclick="addRow()">‚ûï ‡§∞‡•ã ‡§ú‡•ã‡•ú‡•á‡§Ç</button>
    <button onclick="saveData()" style="background: #28a745; color: white;">üíæ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
    <button onclick="clearAll()" style="background: #d32f2f; color: white;">üóëÔ∏è ‡§∞‡§ø‡§∏‡•á‡§ü</button>
</div>

<center>
    <div class="table-container" id="chartArea">
        <canvas id="canvasLayer"></canvas>
        <table id="mainTable"></table>
    </div>
</center>

<div class="dashboard">
    <div class="card">
        <h3>üìç ‡§™‡§ï‡•ú‡•á ‡§ó‡§è ‡§™‡•à‡§ü‡§∞‡•ç‡§® (Table Matches)</h3>
        <div id="matchList">CSV ‡§´‡§æ‡§á‡§≤ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ñ‡§æ‡§≤‡•Ä ‡§¨‡•â‡§ï‡•ç‡§∏ (**) ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç...</div>
    </div>
    <div class="card">
        <h3>üîÆ AI ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä (Next Jodi)</h3>
        <div id="predictionDisplay" style="font-size: 50px; color: var(--gold); text-align: center; margin-top: 10px; font-weight: bold;">--</div>
    </div>
</div>

<script>
let chartData = JSON.parse(localStorage.getItem('kalyan_v8_data')) || [
    ["51","91","41","57","19","95"],
    ["05","90","74","06","19","63"],
    ["90","34","82","09","28","19"],
    ["**","**","**","**","**","**"]
];

let activePoints = [];

// CSV Loader
document.getElementById('csvFile').onchange = function(e) {
    let reader = new FileReader();
    reader.onload = function() {
        chartData = reader.result.split('\n')
                          .filter(r => r.trim() !== "")
                          .map(r => r.split(',').map(v => v.trim().length === 1 ? "0"+v.trim() : v.trim()));
        render();
    };
    reader.readAsText(e.target.files[0]);
};

function render() {
    let html = "<tr><th>‡§∏‡•ã‡§Æ</th><th>‡§Æ‡§Ç‡§ó‡§≤</th><th>‡§¨‡•Å‡§ß</th><th>‡§ó‡•Å‡§∞‡•Å</th><th>‡§∂‡•Å‡§ï‡•ç‡§∞</th><th>‡§∂‡§®‡§ø</th></tr>";
    chartData.forEach((row, rIdx) => {
        html += "<tr>";
        row.forEach((val, cIdx) => {
            let isBlank = (val === "**");
            let displayVal = activePoints.some(p => p.r === rIdx && p.c === cIdx) 
                             ? `<span class="circle">${val}</span>` : val;
            
            html += `<td class="${isBlank ? 'blank' : ''}" 
                        contenteditable="${!isBlank}" 
                        oninput="updateData(${rIdx}, ${cIdx}, this)"
                        onclick="${isBlank ? `analyzeTableTrick(${rIdx}, ${cIdx})` : ''}">
                        ${displayVal}
                    </td>`;
        });
        html += "</tr>";
    });
    document.getElementById('mainTable').innerHTML = html;
    if(activePoints.length > 0) setTimeout(drawLines, 100);
}

// Table Trick Logic: ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§ú‡•ã‡•ú ‡§î‡§∞ ‡§™‡•ã‡§ú‡•Ä‡§∂‡§® ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡§®‡§æ
function analyzeTableTrick(rowIdx, colIdx) {
    let matches = [];
    activePoints = [];
    
    // ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§Æ‡•á‡§Ç ‡§™‡§ø‡§õ‡§≤‡•á ‡§π‡§´‡§º‡•ç‡§§‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç
    for (let i = 2; i < rowIdx; i++) {
        let score = 0;
        let tempPoints = [];

        // ‡§≤‡•â‡§ú‡§ø‡§ï: ‡§Ö‡§ó‡§∞ 2 ‡§π‡§´‡•ç‡§§‡•á ‡§™‡§π‡§≤‡•á ‡§ï‡§æ ‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞ ‡§î‡§∞ ‡§™‡§ø‡§õ‡§≤‡•á ‡§π‡§´‡•ç‡§§‡•á ‡§ï‡§æ ‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞ ‡§è‡§ï ‡§ú‡•à‡§∏‡§æ '‡§ü‡•ã‡§ü‡§≤' ‡§¨‡§®‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç
        if (chartData[i-1] && chartData[rowIdx-1]) {
            let totalOld = (parseInt(chartData[i-1][colIdx][0]) + parseInt(chartData[i-1][colIdx][1])) % 10;
            let totalNew = (parseInt(chartData[rowIdx-1][colIdx][0]) + parseInt(chartData[rowIdx-1][colIdx][1])) % 10;
            
            if (totalOld === totalNew) {
                score++;
                tempPoints.push({r: i-1, c: colIdx});
            }
        }

        if (score > 0) {
            matches.push({targetRow: i, points: tempPoints, score: score});
        }
    }

    displayMatches(matches, colIdx);
}

function displayMatches(matches, col) {
    let list = document.getElementById('matchList');
    list.innerHTML = "";
    
    matches.forEach(m => {
        let div = document.createElement('div');
        div.style.cssText = "background:#333; padding:10px; margin-bottom:5px; cursor:pointer; border-radius:5px;";
        div.innerHTML = `üî• ‡§ü‡•á‡§¨‡§≤ ‡§Æ‡•à‡§ö ‡§Æ‡§ø‡§≤‡§æ (Row: ${m.targetRow + 1})`;
        div.onclick = () => {
            activePoints = m.points;
            render();
            document.getElementById('predictionDisplay').innerText = chartData[m.targetRow][col];
        };
        list.appendChild(div);
    });
}

function drawLines() {
    const canvas = document.getElementById('canvasLayer');
    const table = document.getElementById('mainTable');
    const ctx = canvas.getContext('2d');
    canvas.width = table.offsetWidth;
    canvas.height = table.offsetHeight;
    ctx.clearRect(0,0, canvas.width, canvas.height);

    ctx.strokeStyle = "red";
    ctx.lineWidth = 2;
    let tableRect = table.getBoundingClientRect();

    let circles = document.querySelectorAll('.circle');
    if (circles.length < 1) return;

    let targetCell = document.querySelector('.blank').getBoundingClientRect();

    circles.forEach(c => {
        let r = c.getBoundingClientRect();
        ctx.beginPath();
        ctx.moveTo(targetCell.left - tableRect.left + targetCell.width/2, targetCell.top - tableRect.top + targetCell.height/2);
        ctx.lineTo(r.left - tableRect.left + r.width/2, r.top - tableRect.top + r.height/2);
        ctx.stroke();
    });
}

function updateData(r, c, el) { chartData[r][c] = el.innerText; }
function addRow() { chartData.push(["**","**","**","**","**","**"]); render(); }
function saveData() { localStorage.setItem('kalyan_v8_data', JSON.stringify(chartData)); alert("Data Saved!"); }
function clearAll() { if(confirm("‡§∏‡§¨ ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡•á‡§Ç?")) { localStorage.clear(); location.reload(); } }

render();
</script>
</body>
</html>
