<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>Rajdhani Pro AI â€“ Premium System</title>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  :root {Â 
Â  Â  Â  Â  Â  Â  --gold: #ffd700;Â 
Â  Â  Â  Â  Â  Â  --blue-circle: #0084ff;Â 
Â  Â  Â  Â  Â  Â  --green-line: #00ff88;Â 
Â  Â  Â  Â  Â  Â  --bg: #0f172a;Â 
Â  Â  Â  Â  Â  Â  --panel: #1e293b;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
Â  Â  Â  Â  body { margin: 0; background: var(--bg); color: #fff; overflow-x: hidden; }

Â  Â  Â  Â  #home-screen {
Â  Â  Â  Â  Â  Â  height: 100vh; width: 100vw; display: flex; flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center; justify-content: center; text-align: center;
Â  Â  Â  Â  Â  Â  background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
Â  Â  Â  Â  }
Â  Â  Â  Â  .hero-title { font-size: 3rem; color: var(--gold); margin: 0; text-shadow: 0 0 20px rgba(255,215,0,0.3); }
Â  Â  Â  Â  .hero-sub { opacity: 0.7; letter-spacing: 2px; margin-bottom: 30px; }
Â  Â  Â  Â  .enter-btn {
Â  Â  Â  Â  Â  Â  background: var(--gold); color: #000; padding: 15px 40px;
Â  Â  Â  Â  Â  Â  font-size: 1.2rem; font-weight: 800; border: none; border-radius: 50px;
Â  Â  Â  Â  Â  Â  cursor: pointer; transition: 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
Â  Â  Â  Â  }

Â  Â  Â  Â  #main-app { display: none; padding: 15px; }
Â  Â  Â  Â  .toolbar { background: var(--panel); padding: 12px; border-radius: 12px; margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; border: 1px solid rgba(255,255,255,0.1); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .table-container { position: relative; background: #fff; border-radius: 10px; padding: 5px; box-shadow: 0 0 30px rgba(0,0,0,0.5); display: inline-block; }
Â  Â  Â  Â  table { border-collapse: collapse; color: #000; font-size: 14px; position: relative; z-index: 5; }
Â  Â  Â  Â  td, th { border: 1px solid #ddd; padding: 8px 4px; text-align: center; font-weight: bold; width: 45px; height: 45px; }
Â  Â  Â  Â  th { background: #1e293b; color: white; font-size: 11px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .circle {Â 
Â  Â  Â  Â  Â  Â  border: 3px solid var(--blue-circle) !important;Â 
Â  Â  Â  Â  Â  Â  border-radius: 50% !important;Â 
Â  Â  Â  Â  Â  Â  background: rgba(0, 132, 255, 0.15);Â 
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  }
Â  Â  Â  Â  canvas { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 4; }

Â  Â  Â  Â  .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 20px; }
Â  Â  Â  Â  .card { background: var(--panel); padding: 15px; border-radius: 12px; border-top: 3px solid var(--gold); }
Â  Â  Â  Â  .card h3 { margin: 0 0 10px 0; color: var(--gold); font-size: 14px; text-transform: uppercase; }

Â  Â  Â  Â  #popup { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); background: #fff; border-radius: 15px; display: none; z-index: 100; padding: 15px; color: #000; width: 90%; max-width: 400px; }
Â  Â  Â  Â  .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; z-index: 90; }
Â  Â  Â  Â  button { cursor: pointer; border-radius: 6px; border: none; font-weight: bold; }
Â  Â  </style>
</head>
<body>

<div id="home-screen">
Â  Â  <h1 class="hero-title">Rajdhani PRO AI</h1>
Â  Â  <p class="hero-sub">ADVANCED PATTERN RECOGNITION</p>
Â  Â  <button class="enter-btn" onclick="startApp()">START ANALYSIS</button>
</div>

<div id="main-app">
Â  Â  <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom:10px;">
Â  Â  Â  Â  <h2 style="color:var(--gold); margin:0;">Rajdhani</h2>
Â  Â  Â  Â  <button onclick="location.reload()" style="background:none; color:white; border:1px solid #444; padding:5px 10px;">Logout</button>
Â  Â  </div>

Â  Â  <div class="toolbar">
Â  Â  Â  Â  <input type="file" id="csv" style="display:none">
Â  Â  Â  Â  <button onclick="document.getElementById('csv').click()" style="background:#444; color:white;">ğŸ“‚ CSV</button>
Â  Â  Â  Â  <button onclick="addRow()" style="background:#444; color:white;">â• ROW</button>
Â  Â  Â  Â  <button onclick="saveData()" style="background:#28a745; color:white;">ğŸ’¾ SAVE DATA</button>
Â  Â  Â  Â  <button onclick="clearData()" style="background:#dc3545; color:white;">ğŸ—‘ï¸ CLEAR</button>
Â  Â  </div>

Â  Â  <center>
Â  Â  Â  Â  <div class="table-container">
Â  Â  Â  Â  Â  Â  <canvas id="mainCanvas"></canvas>
Â  Â  Â  Â  Â  Â  <table id="tbl"></table>
Â  Â  Â  Â  </div>
Â  Â  </center>

Â  Â  <div class="dashboard">
Â  Â  Â  Â  <div class="card"><h3>âœ” Matches Found</h3><div id="checks"></div></div>
Â  Â  Â  Â  <div class="card"><h3>ğŸ¤– AI Analysis</h3><div id="ai">Wait for input...</div></div>
Â  Â  Â  Â  <div class="card"><h3>ğŸ”® Future Prediction</h3><div id="future">Select a match...</div></div>
Â  Â  </div>
</div>

<div class="overlay" id="overlay" onclick="closePopup()"></div>
<div id="popup">
Â  Â  <button onclick="closePopup()" style="float:right; background:#000; color:white; padding:5px 10px;">CLOSE</button>
Â  Â  <h3 style="margin: 0 0 15px 0;">Sequence View</h3>
Â  Â  <center><div class="table-container" style="border: 1px solid #ddd;"><canvas id="popCanvas"></canvas><div id="popData"></div></div></center>
</div>

<script>
// --- FIXED LOGIC ---
const STORAGE_KEY="pdata_Rajdhani_v2";
let targetCol=null, activeMark=null;

// Aapka original FAMILY object
const FAMILY = {
Â "22":["22","27","72","77"], "11":["11","61","66","16"], "33":["33","83","88","38"], "99":["99","44","49","94"], "55":["50","00","05","55"],
Â "12":["12","17","21","26","62","67","71","76"], "13":["13","18","31","36","63","68","81","86"], "14":["14","19","41","46","64","69","91","96"],Â Â 
Â "15":["01","06","10","15","51","56","60","65"], "23":["23","28","32","37","73","78","82","87"], "24":["24","29","42","47","74","79","92","97"],Â Â 
Â "25":["02","07","20","25","52","57","70","75"], "34":["34","39","43","48","84","89","93","98"], "35":["03","08","30","35","53","58","80","85"],Â Â 
Â "45":["04","09","40","45","54","59","90","95"]
};

let data=JSON.parse(localStorage.getItem(STORAGE_KEY)) || [["10","20","30","40","50"],["**","**","**","**","**"]];

function startApp() { document.getElementById('home-screen').style.display = 'none'; document.getElementById('main-app').style.display = 'block'; draw(); }

// Fixed: Calling FAMILY correctly
function fam(v){for(let k in FAMILY) if(FAMILY[k].includes(v)) return k; return "NA";}
function palti(v){return (v.length==2) ? v[1]+v[0] : v;}
function norm(v){if(!v||v=="**")return "**"; v=String(v); return v.length==1?"0"+v:v;}
function smartMatch(a,b){ if(a=="**"||b=="**") return false; return a===b || palti(a)===b || fam(a)===fam(b); }

function draw(){
Â let h="<tr><th>MON</th><th>TUE</th><th>WED</th><th>THU</th><th>FRI</th></tr>";
Â data.forEach((r,ri)=>{
Â  h+="<tr>";
Â  r.forEach((c,ci)=>{
Â  Â let cls = (activeMark && isPartOfPattern(ri, ci)) ? "circle" : "";
Â  Â h+=`<td class="${cls}" contenteditable oninput="edit(${ri},${ci},this)" onclick="${c=='**'?'makePattern('+ri+','+ci+')':'' }">${c}</td>`;
Â  });
Â  h+="</tr>";
Â });
Â document.getElementById("tbl").innerHTML=h;
Â if(activeMark) setTimeout(() => drawLines("mainCanvas", document.getElementById("tbl")), 50);
}

function isPartOfPattern(ri, ci){
Â  Â  if(!activeMark) return false;
Â  Â  let i = ri - activeMark.start;
Â  Â  return (i >= 0 && i < activeMark.shape.length && activeMark.shape[i][ci]);
}

function drawLines(cvsId, tblEl) {
Â  Â  const cvs = document.getElementById(cvsId);
Â  Â  const ctx = cvs.getContext("2d");
Â  Â  cvs.width = tblEl.offsetWidth; cvs.height = tblEl.offsetHeight;
Â  Â  ctx.clearRect(0,0,cvs.width,cvs.height);
Â  Â  const cells = tblEl.querySelectorAll(".circle");
Â  Â  if(cells.length < 2) return;
Â  Â  const tRect = tblEl.getBoundingClientRect();
Â  Â  ctx.strokeStyle = "#00ff88"; ctx.lineWidth = 2.5; ctx.beginPath();
Â  Â  cells.forEach((c, idx) => {
Â  Â  Â  Â  const r = c.getBoundingClientRect();
Â  Â  Â  Â  const x = r.left - tRect.left + r.width/2;
Â  Â  Â  Â  const y = r.top - tRect.top + r.height/2;
Â  Â  Â  Â  if(idx === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
Â  Â  });
Â  Â  ctx.stroke();
}

function edit(r,c,el){ data[r][c]=norm(el.innerText.trim()); }
function addRow(){ data.push(["**","**","**","**","**"]); draw(); }
function saveData(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(data)); alert("Saved!"); }
function clearData(){ if(confirm("Clear All?")){ localStorage.clear(); location.reload(); }}

// --- IMPROVED MULTI-PATTERN LOGIC ---

function makePattern(r, c) {
Â  Â  targetCol = c;
Â  Â  let base1 = "**", base2 = "**";
Â  Â  let baseRow1 = -1, baseRow2 = -1;

Â  Â  // 1. Do alag-alag family ki Jodia dhoondhna (Upar ki 10 rows mein)
Â  Â  // Hum pichle 10 hafte ka data check kar rahe hain
Â  Â  for (let i = r; i >= Math.max(0, r - 10); i--) {
Â  Â  Â  Â  for (let j = 0; j < 2; j+) {
Â  Â  Â  Â  Â  Â  let val = data[i][j];
Â  Â  Â  Â  Â  Â  if (val !== "**") {
Â  Â  Â  Â  Â  Â  Â  Â  if (base1 === "**") {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  base1 = val;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  baseRow1 = i;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (base2 === "**" && fam(val) !== fam(base1)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  base2 = val;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  baseRow2 = i;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  if (base1 === "**" || base2 === "**") {
Â  Â  Â  Â  alert("Pattern ke liye kam se kam 2 alag family ki jodi honi chahiye!");
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // 2. Double Shape Build karna
Â  Â  let shape = [];
Â  Â  // Hum current row 'r' se pichle 8-10 rows ka saancha le rahe hain
Â  Â  for (let i = Math.max(0, r - 8); i <= r; i+) {
Â  Â  Â  Â  let row = [];
Â  Â  Â  Â  for (let j = 0; j < 2; j+) {
Â  Â  Â  Â  Â  Â  let cellVal = data[i][j];
Â  Â  Â  Â  Â  Â  let type = 0; // 0 = no match, 1 = base1 family, 2 = base2 family
Â  Â  Â  Â  Â  Â  if (cellVal !== "**") {
Â  Â  Â  Â  Â  Â  Â  Â  if (smartMatch(cellVal, base1)) type = 1;
Â  Â  Â  Â  Â  Â  Â  Â  else if (smartMatch(cellVal, base2)) type = 2;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  row.push(type);
Â  Â  Â  Â  }
Â  Â  Â  Â  shape.push(row);
Â  Â  }

Â  Â  searchMultiPattern(shape, base1, base2);
}

function searchMultiPattern(shape, b1, b2) {
Â  Â  let matches = [];
Â  Â  // Poore record mein scan karega
Â  Â  for (let i = 0; i <= data.length - shape.length; i+) {
Â  Â  Â  Â  let ok = true;
Â  Â  Â  Â  for (let k = 0; k < shape.length; k+) {
Â  Â  Â  Â  Â  Â  for (let j = 0; j < 2; j+) {
Â  Â  Â  Â  Â  Â  Â  Â  let expected = shape[k][j];
Â  Â  Â  Â  Â  Â  Â  Â  if (expected === 1 && !smartMatch(data[i + k][j], b1)) { ok = false; break; }
Â  Â  Â  Â  Â  Â  Â  Â  if (expected === 2 && !smartMatch(data[i + k][j], b2)) { ok = false; break; }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (!ok) break;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (ok) matches.push({ index: i });
Â  Â  }

Â  Â  // Check lines ko draw karne ke liye UI update
Â  Â  showChecks(shape, matches);
Â  Â Â 
Â  Â  // AI Prediction ko update karna (Dono families ka common result)
Â  Â  updateAdvancedAI(shape, matches);
}

function updateAdvancedAI(shape, matches) {
Â  Â  let futurePool = [];
Â  Â  matches.forEach(m => {
Â  Â  Â  Â  let nextRow = m.index + shape.length;
Â  Â  Â  Â  if (nextRow < data.length && data[nextRow][targetCol] !== "**") {
Â  Â  Â  Â  Â  Â  futurePool.push(data[nextRow][targetCol]);
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // AI Box update
Â  Â  document.getElementById("ai").innerHTML = `
Â  Â  Â  Â  <div style="border-left:3px solid var(--green-line); padding-left:10px;">
Â  Â  Â  Â  Â  Â  <p style="margin:2px 0; color:var(--green-line)"><b>Dual-Line Match</b></p>
Â  Â  Â  Â  Â  Â  <small>Dono patterns ka pichla result: ${[...new Set(futurePool)].join(", ") || "N/A"}</small>
Â  Â  Â  Â  </div>
Â  Â  `;

Â  Â  // Separate Future AI Prediction (3-pair prediction as per your instructions)
Â  Â  if (futurePool.length > 0) {
Â  Â  Â  Â  let top3 = futurePool.slice(0, 3);
Â  Â  Â  Â  document.getElementById("future").innerHTML = `
Â  Â  Â  Â  Â  Â  <div style="font-size:1.2rem; color:var(--gold); font-weight:800;">
Â  Â  Â  Â  Â  Â  Â  Â  ${top3.join(" - ")}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <small>Probability: High</small>
Â  Â  Â  Â  `;
Â  Â  }
}

function showChecks(shape, matches){
Â document.getElementById("checks").innerHTML="";
Â matches.forEach((m,i)=>{
Â  let d = document.createElement("div");
Â  d.style = "background:#2a2a2a; margin:5px 0; padding:8px; cursor:pointer; border-radius:6px; font-size:12px; border-left:3px solid #0084ff;";
Â  d.innerText = `Pattern Match Found at Row ${m.index + 1}`;
Â  d.onclick = () => { activeMark={start:m.index, shape:shape}; draw(); showOne(shape, m.index); };
Â  document.getElementById("checks").appendChild(d);
Â });
Â updateAI(shape, matches);
}

function showOne(shape, idx){
Â let html="<table id='popTbl' style='color:#000'>";
Â for(let i=0; i<shape.length; i++){
Â  html+="<tr>";
Â  data[idx+i].forEach((v,j)=>{ html+=`<td class="${shape[i][j]?'circle':''}">${v}</td>`; });
Â  html+="</tr>";
Â }
Â document.getElementById("popData").innerHTML=html+"</table>";
Â document.getElementById("popup").style.display="block";
Â document.getElementById("overlay").style.display="block";
Â setTimeout(()=>drawLines("popCanvas", document.getElementById("popTbl")), 100);
}

function updateAI(shape, matches){
Â let jc={};
Â matches.forEach(m=>{
Â  for(let i=0; i<shape.length; i+){
Â  Â for(let j=0; j<5; j++){
Â  Â  if(shape[i][j]){ let v = data[m.index+i][j]; jc[v]=(jc[v]||0)+1; }
Â  Â }
Â  }
Â });
Â document.getElementById("ai").innerHTML = `<b>Top Pairs:</b> ${Object.keys(jc).slice(0,3).join(", ")}`;
Â let pool = [];
Â matches.forEach(m => {
Â  let nextR = m.index + shape.length;
Â  if(nextR < data.length && data[nextR][targetCol] != "**") pool.push(data[nextR][targetCol]);
Â });
Â document.getElementById("future").innerHTML = pool.length ? `<b>Probable:</b> ${[...new Set(pool)].join(", ")}` : "Analyzing...";
}

function closePopup(){ document.getElementById("popup").style.display="none"; document.getElementById("overlay").style.display="none"; }

document.getElementById("csv").onchange = e => {
Â  Â  let fr = new FileReader();
Â  Â  fr.onload = () => {
Â  Â  Â  Â  data = fr.result.split('\n').filter(l=>l.trim()).map(l => l.split(',').map(v => norm(v.trim())).slice(0,5));
Â  Â  Â  Â  draw();
Â  Â  };
Â  Â  fr.readAsText(e.target.files[0]);
};
</script>
</body>
</html>
